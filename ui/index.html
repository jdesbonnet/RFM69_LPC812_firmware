<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>LPC8xx/RFM69 board UI</title>


     
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

<!-- JQuery -->      
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

<!-- Bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>


<style>
#mapContainer {width:100%;height:540px;background-color:yellow;}
</style>

</head>

<body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">

        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">LPC8xx/RFM69 UI</a>
        </div>

        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">  	
<!--
		<li class="menu_projects"><a href="project-list.jsp"><span class='fa fa-database'></span> Datasets</a></li>
-->

          </ul>
         </div>

      </div>
    </div>
    
    
<br />
<br />
<br />

<div class="container-fluid">
<div class="row">



</div>

<div class="row">


<!--  main area -->
<div class="col-sm-4 col-md-4">
<div id="mapContainer"></div>
</div><!-- end map area-->

<div class="col-sm-4 col-md-4">

<form>
<div class="form-group">
<div class="row">
<div class="col-sm-6 col-md-6">
<label>Latitude</label>
<input type="text" class="form-control" id="latitude" name="latitude" size="12" />
</div>
<div class="col-sm-6 col-md-6">
<label>Longitude</label>
<input type="text" class="form-control" id="longitude" name="longitude" size="12" />
</div>
</div><!-- end .row -->
</div><!-- end .form-group -->
</form>

<div class="row">
<div class="col-sm-6 col-md-6">
<div class="form-group form-inline">
<label>Heading</label><br />
<input type="text" class="form-control" id="heading" name="heading" size="4" value="0"/>
<button type="button" class="btn btn-default" id="heading_dec"><span class="glyphicon glyphicon-minus"></span></button>
<button type="button" class="btn btn-default" id="heading_inc"><span class="glyphicon glyphicon-plus"></span></button>
</div><!-- end .form-group-->
</div><!-- end col -->
<div class="col-sm-6 col-md-6">
<div class="form-group form-inline">
<label>Speed</label><br />
<input type="text" class="form-control" id="speed" name="speed" size="4" value="0.1"/>
<button type="button" class="btn btn-default" id="speed_dec"><span class="glyphicon glyphicon-minus"></span></button>
<button type="button" class="btn btn-default" id="speed_inc"><span class="glyphicon glyphicon-plus"></span></button>
</div><!-- end .form-group -->
</div><!-- end col -->
</div><!-- end .row -->

</div><!-- end controls column-->


<div class="col-sm-4 col-md-4">

<form class="form-inline">
<div class="form-group">
<label>UART Serivce</label><br />
<input type="text" class="form-control" id="ws_url" size="32" value="ws://localhost:8887" />
<button type="button" class="btn btn-default" id="ws_connect_btn"><img src="circle-red.png" /> Connect</button>
</div>
</form>


<form class="form-inline">
<div class="form-group">
<label>Send Radio Command</label><br />
<input type="text" class="form-control" id="radio_cmd" size="32" value="" />
<button type="button" class="btn btn-default" id="radio_cmd_send_btn">Send</button>
</div>
</form>

<table id="message_table" class="list">
<tr><td></td></tr>
</table>



</div><!-- end message area-->



</div><!--  end div.row -->
</div><!--  end div.container-fluid -->

<script src="https://maps.googleapis.com/maps/api/js?libraries=geometry"></script>

<script>
// Icon used to represent a boat
var boatIcon = {
    url: 'circle-red.png',
    size: new google.maps.Size(16, 16),
    origin: new google.maps.Point(0,0),
    anchor: new google.maps.Point(8,8)
};

var boatMarker;
var currentPosition;
var currentLatitude = 53.282;
var currentLongitude = -9.0604;
var updatePeriod = 1;
var webSocket;

var numMessageRows = 0;
var maxMessageRows = 15;

function initializeMap() {

	centerPoint = new google.maps.LatLng(currentLatitude,currentLongitude);

	var mapOptions = {
		center: centerPoint,
		zoom: 18
	};

	map = new google.maps.Map(document.getElementById('mapContainer'),
		mapOptions);

	boatMarker = new google.maps.Marker({
		position: centerPoint,
		map: map,
		icon: boatIcon,
	});


}

function formatTimestamp (date) {
	var hh = date.getUTCHours();
	var mm = date.getUTCMinutes();
	var ss = date.getSeconds();
	var frac_s = (date.getMilliseconds()/1000).toFixed(1);
	if (hh < 10) {hh = "0"+hh;}
	if (mm < 10) {mm = "0"+mm;}
	if (ss < 10) {ss = "0"+ss;}
	return hh+":"+mm+":"+ss;
}

function logEvent (message) {

	var newRow = jQuery('<tr><td>'
			+ formatTimestamp(new Date())
			+ " " + message
			+'</td></tr>').hide();
		
	if (numMessageRows>=maxMessageRows) {
		jQuery('#message_table tr:last').remove();
		jQuery('#message_table tr:first').before(newRow);
		newRow.fadeIn(1000);	
    	} else {
		jQuery("#message_table tr:first").before(newRow);
		newRow.fadeIn(1000);
		numMessageRows++;
	}
}



jQuery(function() {
	initializeMap();


	$("#heading_dec").click(function(){
		var heading = $("#heading").val() | 0;
		heading -= 10;
		heading %= 360;
		$("#heading").val(heading);
	});
	$("#heading_inc").click(function(){
		var heading = $("#heading").val() | 0;
		heading += 10;
		heading %= 360;
		$("#heading").val(heading);
	});
	$("#speed_dec").click(function(){
		var speed = $("#speed").val() * 1;
		speed -= 0.1;
		if (speed<0) speed = 0;
		$("#speed").val(speed.toFixed(1));
	});
	$("#speed_inc").click(function(){
		var speed = $("#speed").val() * 1;
		speed += 0.1;
		$("#speed").val(speed.toFixed(1));
	});

	$("#ws_connect_btn").click(function(){
		var ws_url = $("#ws_url").val();
		logEvent("connecting to " + ws_url);
		webSocket = new WebSocket(ws_url);
		webSocket.onopen=function(){
			alert('open');
		};
		webSocket.onclose=function(){
			alert('close');
		};
		webSocket.onerror=function(){
			alert('error: ' + error);
		};
		webSocket.onmessage=function(event){
			logEvent(event.data);
		};

	});

	setInterval (function(){

		var heading = $("#heading").val();
		var speed = $("#speed").val();

		var curPos = new google.maps.LatLng(currentLatitude,currentLongitude);

		var trailMarker = new google.maps.Marker({
			position: curPos,
			map: map,
			icon: boatIcon,
		});

		var newPos = google.maps.geometry.spherical.computeOffset(curPos, speed*updatePeriod, heading);
		currentLatitude = newPos.lat();
		currentLongitude = newPos.lng();
		boatMarker.setPosition( newPos );
		$("#latitude").val(currentLatitude.toFixed(7));
		$("#longitude").val(currentLongitude.toFixed(7));

		webSocket.send("test");

	 }, updatePeriod*1000);

});
</script>


</body>
   
</html>
